# The AI.IF function

**Preview**

This product or feature is subject to the "Pre-GA Offerings Terms" in the General Service Terms section of the [Service Specific Terms](/terms/service-terms#1) . Pre-GA products and features are available "as is" and might have limited support. For more information, see the [launch stage descriptions](https://cloud.google.com/products/#product-launch-stages) .

**Note:** For support during the preview, contact <bqml-feedback@google.com> .

This document describes the `  AI.IF  ` function, which uses a Vertex AI Gemini model to evaluate a condition described in natural language and returns a `  BOOL  ` .

You can use the `  AI.IF  ` function to filter and join data based on conditions described in natural language or multimodal input. The following are common use cases:

  - **Sentiment analysis** : Find customer reviews with negative sentiment.
  - **Topic analysis** : Identify news articles related to a specific subject.
  - **Image analysis** : Select images that contain a specific item.
  - **Security** : Identify suspicious emails.

## Input

`  AI.IF  ` accepts the following types of input:

  - Text data from standard tables.
  - [`  ObjectRefRuntime  `](/bigquery/docs/reference/standard-sql/objectref_functions#objectrefruntime) values that are generated by the [`  OBJ.GET_ACCESS_URL  ` function](/bigquery/docs/reference/standard-sql/objectref_functions#objget_access_url) . You can use [`  ObjectRef  `](/bigquery/docs/reference/standard-sql/objectref_functions#objectref) values from standard tables as input to the `  OBJ.GET_ACCESS_URL  ` function. ( [Preview](https://cloud.google.com/products#product-launch-stages) )

When you analyze unstructured data, that data must meet the following requirements:

  - Content must be in one of the supported formats that are described in the Gemini API model [`  mimeType  ` parameter](/vertex-ai/generative-ai/docs/model-reference/inference#blob) .
  - For more information about accepted multimodal input, see the [technical specifications](/vertex-ai/generative-ai/docs/models/gemini/2-5-flash#technical-specifications) for Gemini.

This function passes your input to a Gemini model and incurs charges in Vertex AI each time it's called. For information about how to view these charges, see [Track costs](/bigquery/docs/generative-ai-overview#track_costs) .

## Syntax

``` text
AI.IF(
  [ prompt => ] 'PROMPT'
  [, connection_id => 'CONNECTION' ]
  [, endpoint => 'ENDPOINT' ]
)
```

### Arguments

`  AI.IF  ` takes the following arguments:

  - `  PROMPT  ` : a `  STRING  ` or `  STRUCT  ` value that specifies the `  PROMPT  ` value to send to the model. The prompt must be the first argument that you specify. You can provide the value in the following ways:
      - Specify a `  STRING  ` value. For example, 'This is a prompt.'
      - Specify a `  STRUCT  ` value that contains one or more fields. You can use the following types of fields within the `  STRUCT  ` value:
        <table>
        <colgroup>
        <col style="width: 33%" />
        <col style="width: 33%" />
        <col style="width: 33%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>Field type</th>
        <th>Description</th>
        <th>Examples</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><code dir="ltr" translate="no">           STRING          </code><br />
        or<br />
        <code dir="ltr" translate="no">           ARRAY&lt;STRING&gt;          </code></td>
        <td>A string literal, array of string literals, or the name of a <code dir="ltr" translate="no">           STRING          </code> column.</td>
        <td>String literal:<br />
        <code dir="ltr" translate="no">           'This is a prompt.'          </code><br />
        <br />
        String column name:<br />
        <code dir="ltr" translate="no">           my_string_column          </code></td>
        </tr>
        <tr class="even">
        <td><code dir="ltr" translate="no">           ObjectRefRuntime          </code><br />
        or<br />
        <code dir="ltr" translate="no">           ARRAY&lt;ObjectRefRuntime&gt;          </code></td>
        <td><p>An <code dir="ltr" translate="no">            ObjectRefRuntime           </code> value returned by the <a href="/bigquery/docs/reference/standard-sql/objectref_functions#objget_access_url"><code dir="ltr" translate="no">             OBJ.GET_ACCESS_URL            </code> function</a> . The <code dir="ltr" translate="no">            OBJ.GET_ACCESS_URL           </code> function takes an <a href="/bigquery/docs/analyze-multimodal-data#objectref_values"><code dir="ltr" translate="no">             ObjectRef            </code></a> value as input, which you can provide by either specifying the name of a column that contains <code dir="ltr" translate="no">            ObjectRef           </code> values, or by constructing an <code dir="ltr" translate="no">            ObjectRef           </code> value.</p>
        <p><code dir="ltr" translate="no">            ObjectRefRuntime           </code> values must have the <code dir="ltr" translate="no">            access_url.read_url           </code> and <code dir="ltr" translate="no">            details.gcs_metadata.content_type           </code> elements of the JSON value populated.</p>
        <p>Your input can contain at most one video object.</p></td>
        <td>Function call with <code dir="ltr" translate="no">           ObjectRef          </code> column:<br />
        <code dir="ltr" translate="no">           OBJ.GET_ACCESS_URL(my_objectref_column, 'r')          </code><br />
        <br />
        Function call with constructed <code dir="ltr" translate="no">           ObjectRef          </code> value:<br />
        <code dir="ltr" translate="no">           OBJ.GET_ACCESS_URL(OBJ.MAKE_REF('gs://image.jpg', 'myconnection'), 'r')          </code></td>
        </tr>
        </tbody>
        </table>
        The function combines `  STRUCT  ` fields similarly to a [`  CONCAT  `](/bigquery/docs/reference/standard-sql/string_functions#concat) operation and concatenates the fields in their specified order. The same is true for the elements of any arrays used within the struct. The following table shows some examples of `  STRUCT  ` prompt values and how they are interpreted:
        <table>
        <thead>
        <tr class="header">
        <th>Struct field types</th>
        <th>Struct value</th>
        <th>Semantic equivalent</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><code dir="ltr" translate="no">           STRUCT&lt;STRING, STRING, STRING&gt;          </code></td>
        <td><code dir="ltr" translate="no">           ('Describe the city of ', my_city_column, ' in 15 words')          </code></td>
        <td>'Describe the city of my_city_column_value in 15 words'</td>
        </tr>
        <tr class="even">
        <td><code dir="ltr" translate="no">           STRUCT&lt;STRING, ObjectRefRuntime&gt;          </code></td>
        <td><code dir="ltr" translate="no">           ('Describe                   the following city', OBJ.GET_ACCESS_URL(image_objectref_column, 'r'))          </code></td>
        <td>'Describe the following city image '</td>
        </tr>
        </tbody>
        </table>

<!-- end list -->

  - `  CONNECTION  ` : a `  STRING  ` value specifying the connection to use to communicate with the model, in the format `  [ PROJECT_ID ]. LOCATION . CONNECTION_ID  ` . For example, `  myproject.us.myconnection  ` .
    
    If you don't specify a connection, then the query uses your [end-user credentials](/bigquery/docs/permissions-for-ai-functions#run_generative_ai_queries_with_end-user_credentials) .
    
    For information about configuring permissions, see [Set permissions for BigQuery ML generative AI functions that call Vertex AI models](/bigquery/docs/permissions-for-ai-functions) .

  - `  ENDPOINT  ` : a `  STRING  ` value that specifies the Vertex AI endpoint to use for the model. You can specify any [generally available](/vertex-ai/generative-ai/docs/models#generally_available_models) or [preview](/vertex-ai/generative-ai/docs/models#preview_models) Gemini model. If you specify the model name, BigQuery ML automatically identifies and uses the full endpoint of the model. If you don't specify an `  ENDPOINT  ` value, BigQuery ML dynamically chooses a model based on your query to have the best cost to quality tradeoff for the task. You can also specify the [global endpoint](/vertex-ai/generative-ai/docs/learn/locations#use_the_global_endpoint) . For example, to use `  gemini-3-pro-preview  ` , specify the following endpoint:
    
    ``` text
    https://aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/global/publishers/google/models/gemini-3-pro-preview
    ```
    
    **Note:** Don't use the global endpoint if you have requirements for the data processing location, because when you use the global endpoint, you can't control or know the region where your processing requests are handled.

## Output

`  AI.IF  ` returns a `  BOOL  ` based on evaluation of the condition in the input prompt.

If the call to Vertex AI is unsuccessful for any reason, such as exceeding quota or model unavailability, then the function returns `  NULL  ` .

## Examples

The following examples show how to use the `  AI.IF  ` function to filter text and join multimodal data.

### Filter text by topic

The following query uses the `  AI.IF  ` function to filter news stories to those that cover a natural disaster:

``` text
SELECT
  title, body
FROM
  `bigquery-public-data.bbc_news.fulltext`
WHERE
  AI.IF(('The following news story is about a natural disaster: ', body));
```

The result is similar to the following:

``` text
+----------------------------------+---------------------------------------------+
| title                            | body                                        |
+----------------------------------+---------------------------------------------+
| Tsunami 'to hit Sri Lanka banks' | Sri Lanka's banks face hard times following |
|                                  | December's tsunami disaster...              |
| ...                              | ...                                         |
+----------------------------------+---------------------------------------------+
```

### Combine filters

BigQuery optimizes queries to reduce the number of calls to Gemini. The following query first filters by the equality operator, and then filters using the `  AI.IF  ` function:

``` text
SELECT
  title, body
FROM
  `bigquery-public-data.bbc_news.fulltext`
WHERE
  AI.IF(('This news is related to Google: ', body))
  AND category = 'tech';    -- Non-AI filters are evaluated first
```

### Filter images

The following query creates an external table from images of pet products stored in a publicly available Cloud Storage bucket. Then, it filters the results to images that contain a ball.

``` text
-- Create a dataset
CREATE SCHEMA IF NOT EXISTS cymbal_pets;

-- Create an object table
CREATE OR REPLACE EXTERNAL TABLE cymbal_pets.product_images
WITH CONNECTION us.example_connection
OPTIONS (
  object_metadata = 'SIMPLE',
  uris = ['gs://cloud-samples-data/bigquery/tutorials/cymbal-pets/images/*.png']
);

-- Filter images in the object table
SELECT
  STRING(OBJ.GET_ACCESS_URL(ref,'r').access_urls.read_url) AS signed_url,
FROM
  `cymbal_pets.product_images`
WHERE
  AI.IF(('The image contains a ball.', OBJ.GET_ACCESS_URL(ref, 'r')));
```

### Join tables based on image content

The following queries create a table of product data and a table of product images. The tables are joined based on whether the image is of the product.

``` text
-- Create a dataset
CREATE SCHEMA IF NOT EXISTS cymbal_pets;

-- Load a non-object table
LOAD DATA OVERWRITE cymbal_pets.products
FROM
  FILES(
    format = 'avro',
    uris = [
      'gs://cloud-samples-data/bigquery/tutorials/cymbal-pets/tables/products/products_*.avro']);

-- Create an object table
CREATE OR REPLACE EXTERNAL TABLE cymbal_pets.product_images
  WITH CONNECTION us.example_connection
  OPTIONS (
    object_metadata = 'SIMPLE',
    uris = ['gs://cloud-samples-data/bigquery/tutorials/cymbal-pets/images/*.png']);

-- Join the standard table and object table
SELECT product_name, brand, signed_url
FROM
  cymbal_pets.products INNER JOIN
  EXTERNAL_OBJECT_TRANSFORM(TABLE `cymbal_pets.product_images`, ['SIGNED_URL']) as images
ON
  AI.IF(
    (
      """You will be provided an image of a pet product.
      Determine if the image is of the following pet toy: """,
      products.product_name,
      images.ref
    ),
    endpoint => 'gemini-2.5-flash')
WHERE
  products.category = "Toys" AND
  products.brand = "Fluffy Buns";
```

## Filter audio by speech topic

The following queries create a table of audio data stored in a publicly available Cloud Storage bucket. The query filters the audio samples to those that contain speech discussing a large language model.

``` text
-- Create a dataset
CREATE SCHEMA IF NOT EXISTS audio_repo;

-- Create an object table with audios
CREATE OR REPLACE EXTERNAL TABLE audio_repo.prompt_audio
WITH CONNECTION us.test_connection
OPTIONS (
  object_metadata = 'SIMPLE',
  uris = ['gs://cloud-samples-data/generative-ai/audio/*.mp3']
);

-- Filter audios in the object table
SELECT
  STRING(OBJ.GET_ACCESS_URL(ref,'r').access_urls.read_url) AS signed_url,
FROM
  `audio_repo.prompt_audio`
WHERE
  AI.IF(('Does the audio talk about large language models? ', OBJ.GET_ACCESS_URL(ref, 'r')));
```

## Related functions

The `  AI.IF  ` and [`  AI.GENERATE_BOOL  `](/bigquery/docs/reference/standard-sql/bigqueryml-syntax-ai-generate-bool) functions both use models to generate a boolean value in response to a prompt. The following differences can help you choose which function to use:

  - **Prompt Optimization** : `  AI.IF  ` automatically [structures](/vertex-ai/generative-ai/docs/learn/prompts/structure-prompts) your prompts to improve the quality of the output.
  - **Input** : `  AI.GENERATE_BOOL  ` lets you specify model parameters to use.
  - **Output** : `  AI.IF  ` returns a `  BOOL  ` value, which makes it easier to work with in queries. `  AI.GENERATE_BOOL  ` returns a `  STRUCT  ` that contains a `  BOOL  ` value, as well as additional information about the model call, which is useful if you need to view details such as the [safety rating](/vertex-ai/generative-ai/docs/multimodal/configure-safety-filters) or API response status.
  - **Error handling** : If `  AI.IF  ` produces an error for any input, then the function returns `  NULL  ` . `  AI.GENERATE_BOOL  ` records details about the errors in its output.

## Locations

You can run `  AI.IF  ` in all of the [regions](/vertex-ai/generative-ai/docs/learn/locations#google_model_endpoint_locations) that support Gemini models, and also in the `  US  ` and `  EU  ` multi-regions.

## Quotas

See [Generative AI functions quotas and limits](/bigquery/quotas#generative_ai_functions) .

## What's next

  - For more information about using Vertex AI models to generate text and embeddings, see [Generative AI overview](/bigquery/docs/generative-ai-overview) .
  - For more information about using Cloud AI APIs to perform AI tasks, see [AI application overview](/bigquery/docs/ai-application-overview) .
  - For more information about supported SQL statements and functions for generative AI models, see [End-to-end user journeys for generative AI models](/bigquery/docs/e2e-journey-genai) .
  - To use this function in a tutorial, see [Perform semantic analysis with managed AI functions](/bigquery/docs/semantic-analysis) .
