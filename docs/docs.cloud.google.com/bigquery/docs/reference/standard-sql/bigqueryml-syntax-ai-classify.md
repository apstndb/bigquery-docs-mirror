# The AI.CLASSIFY function

**Preview**

This product or feature is subject to the "Pre-GA Offerings Terms" in the General Service Terms section of the [Service Specific Terms](/terms/service-terms#1) . Pre-GA products and features are available "as is" and might have limited support. For more information, see the [launch stage descriptions](https://cloud.google.com/products/#product-launch-stages) .

**Note:** For support during the preview, contact <bqml-feedback@google.com> .

This document describes the `  AI.CLASSIFY  ` function, which uses a Vertex AI Gemini model to classify inputs into categories that you provide. BigQuery automatically [structures](/vertex-ai/generative-ai/docs/learn/prompts/structure-prompts) your input to improve the quality of the classification.

The following are common use cases:

  - **Retail** : Classify reviews by sentiment or classify products by categories.
  - **Text analysis** : Classify support tickets or emails by topic.
  - **Image analysis** : Classify an image by its style or contents.

## Input

`  AI.CLASSIFY  ` accepts the following types of input:

  - Text data from standard tables.
  - [`  ObjectRefRuntime  `](/bigquery/docs/reference/standard-sql/objectref_functions#objectrefruntime) values that are generated by the [`  OBJ.GET_ACCESS_URL  ` function](/bigquery/docs/reference/standard-sql/objectref_functions#objget_access_url) . You can use [`  ObjectRef  `](/bigquery/docs/reference/standard-sql/objectref_functions#objectref) values from standard tables as input to the `  OBJ.GET_ACCESS_URL  ` function.

This function passes your input to a Gemini model and incurs charges in Vertex AI each time it's called. For information about how to view these charges, see [Track costs](/bigquery/docs/generative-ai-overview#track_costs) .

## Syntax

``` text
AI.CLASSIFY(
  [ input => ] 'INPUT',
  [ categories => ] 'CATEGORIES'
  [, connection_id => 'CONNECTION' ]
  [, endpoint => 'ENDPOINT' ]
  [, output_mode => 'OUTPUT_MODE' ]
)
```

### Arguments

`  AI.CLASSIFY  ` takes the following arguments:

  - `  INPUT  ` : a `  STRING  ` or `  STRUCT  ` value that specifies the input to classify. The input must be the first argument that you specify. You can provide the input value in the following ways: You can provide the value in the following ways:
      - Specify a `  STRING  ` value. For example, 'apples'
      - Specify a `  STRUCT  ` value that contains one or more fields. You can use the following types of fields within the `  STRUCT  ` value:
        <table>
        <colgroup>
        <col style="width: 33%" />
        <col style="width: 33%" />
        <col style="width: 33%" />
        </colgroup>
        <thead>
        <tr class="header">
        <th>Field type</th>
        <th>Description</th>
        <th>Examples</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><code dir="ltr" translate="no">           STRING          </code><br />
        or<br />
        <code dir="ltr" translate="no">           ARRAY&lt;STRING&gt;          </code></td>
        <td>A string literal, array of string literals, or the name of a <code dir="ltr" translate="no">           STRING          </code> column.</td>
        <td>String literal:<br />
        <code dir="ltr" translate="no">           'apples'          </code><br />
        <br />
        String column name:<br />
        <code dir="ltr" translate="no">           my_string_column          </code></td>
        </tr>
        <tr class="even">
        <td><code dir="ltr" translate="no">           ObjectRefRuntime          </code><br />
        or<br />
        <code dir="ltr" translate="no">           ARRAY&lt;ObjectRefRuntime&gt;          </code></td>
        <td><p>An <code dir="ltr" translate="no">            ObjectRefRuntime           </code> value returned by the <a href="/bigquery/docs/reference/standard-sql/objectref_functions#objget_access_url"><code dir="ltr" translate="no">             OBJ.GET_ACCESS_URL            </code> function</a> . The <code dir="ltr" translate="no">            OBJ.GET_ACCESS_URL           </code> function takes an <a href="/bigquery/docs/analyze-multimodal-data#objectref_values"><code dir="ltr" translate="no">             ObjectRef            </code></a> value as input, which you can provide by either specifying the name of a column that contains <code dir="ltr" translate="no">            ObjectRef           </code> values, or by constructing an <code dir="ltr" translate="no">            ObjectRef           </code> value.</p>
        <p><code dir="ltr" translate="no">            ObjectRefRuntime           </code> values must have the <code dir="ltr" translate="no">            access_url.read_url           </code> and <code dir="ltr" translate="no">            details.gcs_metadata.content_type           </code> elements of the JSON value populated.</p>
        <p>Your input can contain at most one video object.</p></td>
        <td>Function call with <code dir="ltr" translate="no">           ObjectRef          </code> column:<br />
        <code dir="ltr" translate="no">           OBJ.GET_ACCESS_URL(my_objectref_column, 'r')          </code><br />
        <br />
        Function call with constructed <code dir="ltr" translate="no">           ObjectRef          </code> value:<br />
        <code dir="ltr" translate="no">           OBJ.GET_ACCESS_URL(OBJ.MAKE_REF('gs://image.jpg', 'myconnection'), 'r')          </code></td>
        </tr>
        </tbody>
        </table>
        The function combines `  STRUCT  ` fields similarly to a [`  CONCAT  `](/bigquery/docs/reference/standard-sql/string_functions#concat) operation and concatenates the fields in their specified order. The same is true for the elements of any arrays used within the struct. The following table shows some examples of `  STRUCT  ` prompt values and how they are interpreted:
        <table>
        <thead>
        <tr class="header">
        <th>Struct field types</th>
        <th>Struct value</th>
        <th>Semantic equivalent</th>
        </tr>
        </thead>
        <tbody>
        <tr class="odd">
        <td><code dir="ltr" translate="no">           STRUCT&lt;STRING, STRING, STRING&gt;          </code></td>
        <td><code dir="ltr" translate="no">           ('crisp', color_column, 'apples')          </code></td>
        <td>'crisp color_column apples'</td>
        </tr>
        <tr class="even">
        <td><code dir="ltr" translate="no">           STRUCT&lt;STRING, ObjectRefRuntime&gt;          </code></td>
        <td><code dir="ltr" translate="no">           ('Classify                                      the following city', OBJ.GET_ACCESS_URL(image_objectref_column, 'r'))          </code></td>
        <td>'Classify the following city image '</td>
        </tr>
        </tbody>
        </table>

<!-- end list -->

  - `  CATEGORIES  ` : the categories by which to classify the input. You can specify categories with or without descriptions:
    
      - With descriptions: Use an `  ARRAY<STRUCT<STRING, STRING>>  ` value where each struct contains the category name, followed by a description of the category. The array can only contain string literals. For example, you could use colors to classify sentiment:
        
        `  [('green', 'positive'), ('yellow', 'neutral'), ('red', 'negative')]  `
        
        You can optionally name the fields of the struct for your own readability, but the field names aren't used by the function:
        
        ``` text
          [STRUCT('green' AS label, 'positive' AS description),
           STRUCT('yellow' AS label, 'neutral' AS description),
           STRUCT('red' AS label, 'negative' AS description)]
        ```
    
      - Without descriptions: Use an `  ARRAY<STRING>  ` value. The array can only contain string literals. This works well when your categories are self-explanatory. For example, you could use the following categories to classify sentiment:
        
        `  ['positive', 'neutral', 'negative']  `
    
    To handle input that doesn't closely match a category, consider including an `  'Other'  ` category.

  - `  CONNECTION  ` : a `  STRING  ` value specifying the connection to use to communicate with the model, in the format `  [ PROJECT_ID ]. LOCATION . CONNECTION_ID  ` . For example, `  myproject.us.myconnection  ` .
    
    If you don't specify a connection, then the query uses your [end-user credentials](/bigquery/docs/permissions-for-ai-functions#run_generative_ai_queries_with_end-user_credentials) .
    
    For information about configuring permissions, see [Set permissions for BigQuery ML generative AI functions that call Vertex AI models](/bigquery/docs/permissions-for-ai-functions) .

  - `  ENDPOINT  ` : a `  STRING  ` value that specifies the Vertex AI endpoint to use for the model. You can specify any [generally available](/vertex-ai/generative-ai/docs/models#generally_available_models) or [preview](/vertex-ai/generative-ai/docs/models#preview_models) Gemini model. If you specify the model name, BigQuery ML automatically identifies and uses the full endpoint of the model. If you don't specify an `  ENDPOINT  ` value, BigQuery ML dynamically chooses a model based on your query to have the best cost to quality tradeoff for the task. You can also specify the [global endpoint](/vertex-ai/generative-ai/docs/learn/locations#use_the_global_endpoint) . For example, to use `  gemini-3-pro-preview  ` , specify the following endpoint:
    
    ``` text
    https://aiplatform.googleapis.com/v1/projects/PROJECT_ID/locations/global/publishers/google/models/gemini-3-pro-preview
    ```
    
    **Note:** Don't use the global endpoint if you have requirements for the data processing location, because when you use the global endpoint, you can't control or know the region where your processing requests are handled.

  - `  OUTPUT_MODE  ` : a `  STRING  ` value that indicates whether a single input can be classified into multiple categories. Specifying an output mode changes the return type of the function to `  ARRAY<STRING>  ` . The supported values are the following:
    
      - `  single  ` : Each input is classified into exactly one category.
      - `  multi  ` : Each value is classified into zero or more categories. In this case, the function returns an array that contains each relevant category, or an empty array if no category applies.

## Output

If you don't specify an `  OUTPUT_MODE  ` , then `  AI.CLASSIFY  ` returns a `  STRING  ` value containing the category that best fits the input.

If you specify an `  OUTPUT_MODE  ` , then `  AI.CLASSIFY  ` returns an `  ARRAY<STRING>  ` value that contains all categories that the input is classified into. If `  OUTPUT_MODE  ` is `  single  ` then the array always has length 1. If `  OUTPUT_MODE  ` is `  multi  ` then the array length is between 0 and the number of categories.

If the call to Vertex AI is unsuccessful for any reason, such as exceeding quota or model unavailability, then the function returns `  NULL  ` .

## Examples

The following examples show how to use the `  AI.CLASSIFY  ` function to classify text and images into predefined categories.

### Classify text by topic

The following query categorizes BBC news articles into high-level categories:

``` text
SELECT
  title,
  body,
  AI.CLASSIFY(
    body,
    categories => ['tech', 'sport', 'business', 'politics', 'entertainment', 'other']) AS category
FROM
  `bigquery-public-data.bbc_news.fulltext`
LIMIT 100;
```

The result is similar to the following:

``` text
+-------------------------------+------------------------------------+----------+
| title                         | body                               | category |
+-------------------------------+------------------------------------+----------+
| Anti-spam screensave scrapped | A contentious campaign to bump up  | tech     |
|                               | the bandwidth bills of spammers... |          |
| ...                           | ...                                | ...      |
+-------------------------------+------------------------------------+----------+
```

### Classify text into multiple topics

The following query categorizes BBC news articles into high-level categories and allows the function to assign multiple categories to each article:

``` text
SELECT
  title,
  body,
  AI.CLASSIFY(
    body,
    categories => ['tech', 'sport', 'business', 'politics', 'entertainment', 'other'],
    output_mode => 'multi') AS categories
FROM
  `bigquery-public-data.bbc_news.fulltext`
LIMIT 100;
```

The result is similar to the following:

``` text
+-------------------------------+------------------------------------+------------------+
| title                         | body                               | categories       |
+-------------------------------+------------------------------------+------------------+
| Anti-spam screensave scrapped | A contentious campaign to bump up  | [tech, business] |
|                               | the bandwidth bills of spammers... |                  |
| ...                           | ...                                | ...              |
+-------------------------------+------------------------------------+------------------+
```

### Classify reviews by sentiment

The following query classifies movie reviews of The English Patient by sentiment according to a custom color scheme. For example, a review that is very positive is classified as 'green'.

``` text
SELECT
  AI.CLASSIFY(
    ('Classify the review by sentiment: ', review),
    categories =>
         [('green', 'The review is positive.'),
          ('yellow', 'The review is neutral.'),
          ('red', 'The review is negative.')]) AS ai_review_rating,
  reviewer_rating AS human_provided_rating,
  review,
FROM
  `bigquery-public-data.imdb.reviews`
WHERE
  title = 'The English Patient'
```

### Classify images by type

The following query creates an external table from images of pet products stored in a publicly available Cloud Storage bucket. Then, it classifies each image as a box, ball, bottle, stand, or other type of item.

``` text
-- Create a dataset
CREATE SCHEMA IF NOT EXISTS cymbal_pets;

-- Create an object table
CREATE OR REPLACE EXTERNAL TABLE cymbal_pets.product_images
WITH CONNECTION us.example_connection
OPTIONS (
 object_metadata = 'SIMPLE',
 uris = ['gs://cloud-samples-data/bigquery/tutorials/cymbal-pets/images/*.png']
);

-- Classify images in the object table
SELECT
  signed_url,
  AI.CLASSIFY(
    images.ref,
    ['box', 'ball', 'bottle', 'stand', 'other'],
    endpoint => 'gemini-2.5-flash') AS category
FROM
  EXTERNAL_OBJECT_TRANSFORM(TABLE `cymbal_pets.product_images`,
                              ['SIGNED_URL']) AS images
LIMIT 10;
```

## Locations

You can run `  AI.CLASSIFY  ` in all of the [regions](/vertex-ai/generative-ai/docs/learn/locations#google_model_endpoint_locations) that support Gemini models, and also in the `  US  ` and `  EU  ` multi-regions.

## Quotas

See [Generative AI functions quotas and limits](/bigquery/quotas#generative_ai_functions) .

## What's next

  - For more information about using Vertex AI models to generate text and embeddings, see [Generative AI overview](/bigquery/docs/generative-ai-overview) .
  - For more information about using Cloud AI APIs to perform AI tasks, see [AI application overview](/bigquery/docs/ai-application-overview) .
  - For more information about supported SQL statements and functions for generative AI models, see [End-to-end user journeys for generative AI models](/bigquery/docs/e2e-journey-genai) .
  - To use this function in a tutorial, see [Perform semantic analysis with managed AI functions](/bigquery/docs/semantic-analysis) .
